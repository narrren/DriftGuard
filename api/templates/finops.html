<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DriftGuard ‚Äî FinOps Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: #0a0f1e;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .sidebar-item {
            transition: all 0.15s ease;
        }

        .sidebar-item:hover,
        .sidebar-item.active {
            background: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.3);
            color: white;
        }

        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.06);
        }

        .glow-text {
            text-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }

            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        .pulse-ring::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 2px solid #10b981;
            animation: pulse-ring 2s infinite;
        }

        .status-dot {
            position: relative;
            display: inline-block;
        }

        .btn-action {
            transition: all 0.2s ease;
        }

        .btn-action:hover {
            transform: translateY(-1px);
        }

        .btn-action:active {
            transform: translateY(0);
        }

        .toast {
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .bar {
            transition: height 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes count-up {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .count-up {
            animation: count-up 0.5s ease forwards;
        }
    </style>
</head>

<body class="text-slate-300 min-h-screen flex">

    <!-- Sidebar -->
    <aside class="w-64 flex-shrink-0 border-r border-white/5 bg-[#0d1117] flex flex-col h-screen sticky top-0">
        <div class="p-6 border-b border-white/5">
            <a href="/" class="flex items-center gap-3">
                <div
                    class="w-9 h-9 rounded-xl bg-gradient-to-tr from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-lg shadow-indigo-500/20">
                    D</div>
                <span class="text-lg font-bold text-white">DriftGuard</span>
            </a>
        </div>
        <div
            class="px-4 py-3 mx-4 mt-4 rounded-xl bg-emerald-500/10 border border-emerald-500/20 flex items-center gap-2">
            <span class="status-dot pulse-ring w-2 h-2 rounded-full bg-emerald-400 flex-shrink-0"></span>
            <span class="text-xs font-semibold text-emerald-400 font-mono">LIVE MODE</span>
        </div>
        <nav class="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
            <a href="/dashboard"
                class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg border border-transparent text-sm font-medium text-slate-400"><span>üè†</span>
                Dashboard</a>
            <a href="/ai-guard"
                class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg border border-transparent text-sm font-medium text-slate-400"><span>üß†</span>
                AI Guard</a>
            <a href="/janitor"
                class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg border border-transparent text-sm font-medium text-slate-400"><span>üßπ</span>
                Janitor</a>
            <a href="/sentry"
                class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg border border-transparent text-sm font-medium text-slate-400"><span>üõ°Ô∏è</span>
                Sentry</a>
            <a href="/finops"
                class="sidebar-item active flex items-center gap-3 px-3 py-2.5 rounded-lg border border-transparent text-sm font-medium"><span>üí∞</span>
                FinOps</a>
            <a href="/policy"
                class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg border border-transparent text-sm font-medium text-slate-400"><span>üìã</span>
                Policy</a>
        </nav>
        <div class="p-4 border-t border-white/5">
            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">Cloud Connections</p>
            <div class="space-y-2">
                <div class="flex items-center justify-between text-xs"><span class="text-slate-400">AWS</span><span
                        id="sb-aws" class="text-slate-600 font-mono">‚Äî</span></div>
                <div class="flex items-center justify-between text-xs"><span class="text-slate-400">Azure</span><span
                        id="sb-azure" class="text-slate-600 font-mono">‚Äî</span></div>
                <div class="flex items-center justify-between text-xs"><span class="text-slate-400">GCP</span><span
                        id="sb-gcp" class="text-slate-600 font-mono">‚Äî</span></div>
            </div>
        </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 overflow-y-auto">
        <header
            class="sticky top-0 z-40 border-b border-white/5 bg-[#0a0f1e]/80 backdrop-blur-xl px-8 py-4 flex items-center justify-between">
            <div>
                <h1 class="text-xl font-bold text-white glow-text">üí∞ FinOps Intelligence</h1>
                <p class="text-xs text-slate-500 font-mono mt-0.5">Real-time cost velocity tracking & budget burn rate
                    analysis</p>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="loadStats(false)" id="btnLoad"
                    class="btn-action px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-semibold rounded-lg shadow-lg shadow-indigo-600/20">‚Üª
                    Load Stats</button>
                <button onclick="loadStats(true)"
                    class="btn-action px-4 py-2 border border-red-500/30 hover:bg-red-500/10 text-red-400 text-sm font-medium rounded-lg transition">‚ö°
                    Simulate Spike</button>
            </div>
        </header>

        <div class="p-8 space-y-8">
            <!-- Alert Banner (hidden by default) -->
            <div id="alertBanner"
                class="hidden rounded-xl border border-red-500/30 bg-red-500/5 p-4 flex items-start gap-3">
                <span class="text-2xl">üö®</span>
                <div>
                    <p class="text-red-400 font-semibold" id="alertTitle">Alert</p>
                    <p class="text-red-300/70 text-sm" id="alertMsg"></p>
                </div>
                <button onclick="document.getElementById('alertBanner').classList.add('hidden')"
                    class="ml-auto text-slate-500 hover:text-white">‚úï</button>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="glass rounded-xl p-5">
                    <p class="text-xs text-slate-500 uppercase tracking-wider mb-1">Credits Used</p>
                    <p class="text-3xl font-bold text-white">$<span id="statUsed">0.00</span></p>
                    <p class="text-xs text-slate-500 mt-1">of $1,000 budget</p>
                </div>
                <div class="glass rounded-xl p-5">
                    <p class="text-xs text-slate-500 uppercase tracking-wider mb-1">Remaining</p>
                    <p class="text-3xl font-bold text-white">$<span id="statRemaining">1000.00</span></p>
                    <p class="text-xs text-emerald-400 mt-1" id="statPct">0% used</p>
                </div>
                <div class="glass rounded-xl p-5">
                    <p class="text-xs text-slate-500 uppercase tracking-wider mb-1">Zombies Reaped</p>
                    <p class="text-3xl font-bold text-white" id="statZombies">0</p>
                    <p class="text-xs text-emerald-400 mt-1">‚Üë this week</p>
                </div>
                <div class="glass rounded-xl p-5">
                    <p class="text-xs text-slate-500 uppercase tracking-wider mb-1">Burn Rate</p>
                    <p class="text-3xl font-bold text-white" id="statBurnRate">$0</p>
                    <p class="text-xs text-slate-500 mt-1">per day avg</p>
                </div>
            </div>

            <!-- Chart + Breakdown -->
            <div class="grid md:grid-cols-3 gap-6">
                <!-- Bar Chart -->
                <div class="glass rounded-xl p-6 md:col-span-2">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-sm font-semibold text-white flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-indigo-400"></span>
                            Cost Velocity ‚Äî Last 7 Days
                        </h2>
                        <span id="chartBadge"
                            class="text-xs font-mono px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">Normal</span>
                    </div>
                    <div class="flex items-end justify-between gap-2 h-40" id="barChart">
                        <!-- Bars rendered by JS -->
                        <div class="flex flex-col items-center gap-1 flex-1">
                            <div class="bar w-full bg-indigo-500/20 rounded-t" style="height:40%"></div><span
                                class="text-xs text-slate-600 font-mono">Mon</span>
                        </div>
                        <div class="flex flex-col items-center gap-1 flex-1">
                            <div class="bar w-full bg-indigo-500/20 rounded-t" style="height:40%"></div><span
                                class="text-xs text-slate-600 font-mono">Tue</span>
                        </div>
                        <div class="flex flex-col items-center gap-1 flex-1">
                            <div class="bar w-full bg-indigo-500/20 rounded-t" style="height:40%"></div><span
                                class="text-xs text-slate-600 font-mono">Wed</span>
                        </div>
                        <div class="flex flex-col items-center gap-1 flex-1">
                            <div class="bar w-full bg-indigo-500/30 rounded-t border-t-2 border-indigo-400"
                                style="height:40%"></div><span class="text-xs text-slate-600 font-mono">Thu</span>
                        </div>
                        <div class="flex flex-col items-center gap-1 flex-1">
                            <div class="bar w-full bg-indigo-500/20 rounded-t" style="height:40%"></div><span
                                class="text-xs text-slate-600 font-mono">Fri</span>
                        </div>
                        <div class="flex flex-col items-center gap-1 flex-1">
                            <div class="bar w-full bg-indigo-500/20 rounded-t" style="height:40%"></div><span
                                class="text-xs text-slate-600 font-mono">Sat</span>
                        </div>
                        <div class="flex flex-col items-center gap-1 flex-1">
                            <div class="bar w-full bg-indigo-500/20 rounded-t" style="height:40%"></div><span
                                class="text-xs text-slate-600 font-mono">Sun</span>
                        </div>
                    </div>
                </div>

                <!-- Spend Breakdown -->
                <div class="glass rounded-xl p-6">
                    <h2 class="text-sm font-semibold text-white mb-4 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-purple-400"></span>
                        Spend Breakdown
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-xs mb-1.5"><span
                                    class="text-slate-400">Compute</span><span class="text-white font-mono"
                                    id="computePct">65%</span></div>
                            <div class="h-2 rounded-full bg-white/5 overflow-hidden">
                                <div id="computeBar"
                                    class="h-full rounded-full bg-indigo-500 transition-all duration-700"
                                    style="width:65%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs mb-1.5"><span
                                    class="text-slate-400">Storage</span><span class="text-white font-mono"
                                    id="storagePct">25%</span></div>
                            <div class="h-2 rounded-full bg-white/5 overflow-hidden">
                                <div id="storageBar"
                                    class="h-full rounded-full bg-purple-500 transition-all duration-700"
                                    style="width:25%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs mb-1.5"><span
                                    class="text-slate-400">Network</span><span class="text-white font-mono"
                                    id="networkPct">10%</span></div>
                            <div class="h-2 rounded-full bg-white/5 overflow-hidden">
                                <div id="networkBar"
                                    class="h-full rounded-full bg-emerald-500 transition-all duration-700"
                                    style="width:10%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-white/5 space-y-2">
                        <div class="flex justify-between text-xs"><span class="text-slate-500">Budget Limit</span><span
                                class="text-white font-mono">$1,000.00</span></div>
                        <div class="flex justify-between text-xs"><span class="text-slate-500">Forecast
                                (30d)</span><span class="text-white font-mono" id="forecast30d">$0.00</span></div>
                    </div>
                </div>
            </div>

            <!-- Anomalies + Log -->
            <div class="grid md:grid-cols-2 gap-6">
                <div class="glass rounded-xl p-6">
                    <h2 class="text-sm font-semibold text-white mb-4 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-red-400"></span>
                        Recent Anomalies
                    </h2>
                    <div class="space-y-3">
                        <div class="flex items-start gap-3 p-3 rounded-lg bg-red-500/5 border border-red-500/10">
                            <span class="text-lg">‚ö†Ô∏è</span>
                            <div>
                                <p class="text-sm font-semibold text-red-300">RDS Spike Detected</p>
                                <p class="text-xs text-slate-500">+240% cost increase in us-east-1</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3 p-3 rounded-lg bg-yellow-500/5 border border-yellow-500/10">
                            <span class="text-lg">üí°</span>
                            <div>
                                <p class="text-sm font-semibold text-yellow-300">Unused EIPs</p>
                                <p class="text-xs text-slate-500">5 addresses idle > 48hrs</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3 p-3 rounded-lg bg-white/[0.02] border border-white/5">
                            <span class="text-lg">‚úÖ</span>
                            <div>
                                <p class="text-sm font-semibold text-emerald-300">Janitor Saved $89</p>
                                <p class="text-xs text-slate-500">12 zombie resources reaped</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass rounded-xl p-6">
                    <h2 class="text-sm font-semibold text-white mb-4 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-yellow-400"></span>
                        FinOps Event Log
                    </h2>
                    <div id="finopsLog" class="font-mono text-xs text-slate-400 space-y-1.5 h-40 overflow-y-auto">
                        <div class="text-slate-600">Click "Load Stats" to fetch real cost data...</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast -->
    <div id="toast"
        class="toast fixed bottom-6 right-6 z-50 px-5 py-3 rounded-xl text-sm font-medium text-white shadow-2xl flex items-center gap-3 min-w-[280px]">
        <span id="toastIcon">‚úì</span><span id="toastMsg">Done</span>
    </div>

    <script>
        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').textContent = msg;
            document.getElementById('toastIcon').textContent = type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : '‚Ñπ';
            toast.className = `toast show fixed bottom-6 right-6 z-50 px-5 py-3 rounded-xl text-sm font-medium text-white shadow-2xl flex items-center gap-3 min-w-[280px] ${type === 'success' ? 'bg-emerald-600' : type === 'error' ? 'bg-red-600' : 'bg-indigo-600'}`;
            setTimeout(() => toast.classList.remove('show'), 3500);
        }
        function addLog(msg, type = 'info') {
            const log = document.getElementById('finopsLog');
            const colors = { info: 'text-slate-400', success: 'text-emerald-400', error: 'text-red-400', warn: 'text-yellow-400' };
            const time = new Date().toLocaleTimeString();
            if (log.querySelector('.text-slate-600')) log.innerHTML = '';
            log.innerHTML += `<div class="${colors[type] || 'text-slate-400'}">[${time}] ${msg}</div>`;
            log.scrollTop = log.scrollHeight;
        }
        async function loadStats(simulateSpike = false) {
            const btn = document.getElementById('btnLoad');
            btn.textContent = '‚è≥ Loading...'; btn.disabled = true;
            addLog(simulateSpike ? 'Simulating cost spike...' : 'Fetching real cost data...', 'info');
            showToast(simulateSpike ? 'Simulating spike...' : 'Loading stats...', 'info');
            try {
                const url = '/api/finops/stats' + (simulateSpike ? '?simulate_leak=true' : '');
                const res = await fetch(url);
                const data = await res.json();
                // Update stats
                document.getElementById('statUsed').textContent = data.credits.used.toFixed(2);
                document.getElementById('statRemaining').textContent = data.credits.remaining.toFixed(2);
                const pct = Math.round((data.credits.used / data.credits.limit) * 100);
                const pctEl = document.getElementById('statPct');
                pctEl.textContent = pct + '% used';
                pctEl.className = `text-xs mt-1 ${pct > 70 ? 'text-red-400' : pct > 40 ? 'text-yellow-400' : 'text-emerald-400'}`;
                // Zombies
                const totalZombies = data.zombies_reaped?.reduce((a, b) => a + b, 0) || 0;
                document.getElementById('statZombies').textContent = totalZombies;
                // Burn rate
                const avgDaily = data.credits.used / 7;
                document.getElementById('statBurnRate').textContent = '$' + avgDaily.toFixed(2);
                // Forecast
                document.getElementById('forecast30d').textContent = '$' + (avgDaily * 30).toFixed(2);
                // Update bars
                const bars = document.querySelectorAll('#barChart .bar');
                const maxVal = Math.max(...data.actual_spend);
                data.actual_spend.forEach((val, i) => {
                    if (bars[i]) {
                        const h = Math.round((val / maxVal) * 90) + 10;
                        bars[i].style.height = h + '%';
                        if (simulateSpike && i >= 5) {
                            bars[i].className = 'bar w-full bg-red-500/40 rounded-t border-t-2 border-red-400';
                        } else {
                            bars[i].className = i === 3 ? 'bar w-full bg-indigo-500/30 rounded-t border-t-2 border-indigo-400' : 'bar w-full bg-indigo-500/20 rounded-t';
                        }
                    }
                });
                // Alert
                if (data.alert) {
                    document.getElementById('alertBanner').classList.remove('hidden');
                    document.getElementById('alertTitle').textContent = data.alert.title;
                    document.getElementById('alertMsg').textContent = data.alert.msg;
                    document.getElementById('chartBadge').textContent = 'üö® Spike';
                    document.getElementById('chartBadge').className = 'text-xs font-mono px-2 py-1 rounded-full bg-red-500/10 text-red-400 border border-red-500/20';
                    addLog(`ALERT: ${data.alert.msg}`, 'error');
                    showToast('Cost spike detected!', 'error');
                } else {
                    document.getElementById('chartBadge').textContent = 'Normal';
                    document.getElementById('chartBadge').className = 'text-xs font-mono px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20';
                    addLog(`Stats loaded ‚Äî $${data.credits.used.toFixed(2)} used of $${data.credits.limit}`, 'success');
                    showToast('Stats loaded!', 'success');
                }
            } catch (e) {
                addLog(`Error: ${e.message}`, 'error');
                showToast('Failed to load stats', 'error');
            }
            btn.textContent = '‚Üª Load Stats'; btn.disabled = false;
        }
        async function loadSidebarStatus() {
            try {
                const res = await fetch('/auth/status');
                const status = await res.json();
                ['aws', 'azure', 'gcp'].forEach(k => {
                    const el = document.getElementById(`sb-${k}`);
                    if (el) el.innerHTML = status[k]?.connected
                        ? '<span class="text-emerald-400">‚óè on</span>'
                        : '<span class="text-slate-600">‚óã off</span>';
                });
            } catch (e) { }
        }
        loadSidebarStatus();
        loadStats(false);
    </script>
</body>

</html>