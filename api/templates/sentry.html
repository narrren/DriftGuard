<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>DriftGuard - Cross-Repo Sentry</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13b6ec",
                        "background-dark": "#101d22",
                        "surface-dark": "#16262c",
                        "border-dark": "#233f48",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"],
                        "mono": ["JetBrains Mono", "monospace"],
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        .sidebar-active {
            background: rgba(19, 182, 236, 0.12);
            color: #13b6ec;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #0d161a;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #233f48;
            border-radius: 3px;
        }

        /* Radar */
        .radar-ring {
            border-radius: 50%;
            border: 1px solid rgba(19, 182, 236, 0.15);
            position: absolute;
            transform: translate(-50%, -50%);
        }

        .radar-sweep {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            background: conic-gradient(from 0deg, transparent 0deg, rgba(19, 182, 236, 0.25) 60deg, transparent 60deg);
            animation: sweep 4s linear infinite;
            border-radius: 0 0 0 100%;
        }

        @keyframes sweep {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .radar-blip {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #13b6ec;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 6px 2px rgba(19, 182, 236, 0.5);
            animation: blip 2s ease-in-out infinite;
        }

        @keyframes blip {

            0%,
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1)
            }

            50% {
                opacity: 0.4;
                transform: translate(-50%, -50%) scale(0.7)
            }
        }

        .radar-blip-red {
            background: #ef4444;
            box-shadow: 0 0 6px 2px rgba(239, 68, 68, 0.5);
            animation: blip-red 1.5s ease-in-out infinite;
        }

        @keyframes blip-red {

            0%,
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1)
            }

            50% {
                opacity: 0.5;
                transform: translate(-50%, -50%) scale(0.8)
            }
        }
    </style>
</head>

<body class="bg-background-dark font-display antialiased min-h-screen text-white">
    <div class="flex h-screen w-full overflow-hidden">

        <!-- Sidebar -->
        <aside
            class="w-64 bg-background-dark border-r border-border-dark flex flex-col justify-between py-6 px-4 shrink-0 overflow-y-auto">
            <div class="flex flex-col gap-6">
                <!-- Brand -->
                <div class="flex items-center gap-3 px-3 mb-2">
                    <div class="size-8 text-primary">
                        <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                            <path clip-rule="evenodd"
                                d="M39.475 21.6262C40.358 21.4363 40.6863 21.5589 40.7581 21.5934C40.7876 21.655 40.8547 21.857 40.8082 22.3336C40.7408 23.0255 40.4502 24.0046 39.8572 25.2301C38.6799 27.6631 36.5085 30.6631 33.5858 33.5858C30.6631 36.5085 27.6632 38.6799 25.2301 39.8572C24.0046 40.4502 23.0255 40.7407 22.3336 40.8082C21.8571 40.8547 21.6551 40.7875 21.5934 40.7581C21.5589 40.6863 21.4363 40.358 21.6262 39.475C21.8562 38.4054 22.4689 36.9657 23.5038 35.2817C24.7575 33.2417 26.5497 30.9744 28.7621 28.762C30.9744 26.5497 33.2417 24.7574 35.2817 23.5037C36.9657 22.4689 38.4054 21.8562 39.475 21.6262ZM4.41189 29.2403L18.7597 43.5881C19.8813 44.7097 21.4027 44.9179 22.7217 44.7893C24.0585 44.659 25.5148 44.1631 26.9723 43.4579C29.9052 42.0387 33.2618 39.5667 36.4142 36.4142C39.5667 33.2618 42.0387 29.9052 43.4579 26.9723C44.1631 25.5148 44.659 24.0585 44.7893 22.7217C44.9179 21.4027 44.7097 19.8813 43.5881 18.7597L29.2403 4.41187C27.8527 3.02428 25.8765 3.02573 24.2861 3.36776C22.6081 3.72863 20.7334 4.58419 18.8396 5.74801C16.4978 7.18716 13.9881 9.18353 11.5858 11.5858C9.18354 13.988 7.18717 16.4978 5.74802 18.8396C4.58421 20.7334 3.72865 22.6081 3.36778 24.2861C3.02574 25.8765 3.02429 27.8527 4.41189 29.2403Z"
                                fill="currentColor" fill-rule="evenodd"></path>
                        </svg>
                    </div>
                    <span class="text-white text-lg font-bold tracking-tight">DriftGuard</span>
                </div>
                <div>
                    <h3 class="text-[#92bbc9] text-xs font-bold uppercase tracking-wider mb-4 px-3">Platform</h3>
                    <nav class="flex flex-col gap-1">
                        <a class="flex items-center gap-3 px-3 py-2 text-[#92bbc9] hover:text-white hover:bg-border-dark rounded-lg transition-colors group"
                            href="/dashboard">
                            <span
                                class="material-symbols-outlined text-[20px] group-hover:text-primary">dashboard</span><span
                                class="text-sm font-medium">Dashboard</span>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 text-[#92bbc9] hover:text-white hover:bg-border-dark rounded-lg transition-colors group"
                            href="/ai-guard">
                            <span
                                class="material-symbols-outlined text-[20px] group-hover:text-primary">psychology</span><span
                                class="text-sm font-medium">AI Guard</span>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 text-[#92bbc9] hover:text-white hover:bg-border-dark rounded-lg transition-colors group"
                            href="/janitor">
                            <span
                                class="material-symbols-outlined text-[20px] group-hover:text-primary">delete</span><span
                                class="text-sm font-medium">Janitor</span>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 sidebar-active rounded-lg" href="/sentry">
                            <span class="material-symbols-outlined text-[20px]">radar</span><span
                                class="text-sm font-medium">Sentry</span>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 text-[#92bbc9] hover:text-white hover:bg-border-dark rounded-lg transition-colors group"
                            href="/finops">
                            <span
                                class="material-symbols-outlined text-[20px] group-hover:text-primary">savings</span><span
                                class="text-sm font-medium">FinOps</span>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 text-[#92bbc9] hover:text-white hover:bg-border-dark rounded-lg transition-colors group"
                            href="/policy">
                            <span
                                class="material-symbols-outlined text-[20px] group-hover:text-primary">rule</span><span
                                class="text-sm font-medium">Policy</span>
                        </a>
                    </nav>
                </div>
            </div>
            <a href="/login" class="flex items-center gap-3 px-3 py-2 text-[#92bbc9] hover:text-white cursor-pointer">
                <span class="material-symbols-outlined text-[20px]">logout</span><span class="text-sm font-medium">Sign
                    Out</span>
            </a>
        </aside>

        <!-- Main -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="px-8 py-5 border-b border-border-dark bg-background-dark shrink-0">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="flex items-center gap-2 text-sm text-slate-400 mb-1">
                            <a class="hover:text-primary" href="/dashboard">DriftGuard</a>
                            <span class="material-symbols-outlined text-[16px]">chevron_right</span>
                            <span class="text-white font-medium">Sentry</span>
                        </div>
                        <h1 class="text-2xl font-bold text-white tracking-tight">Cross-Repo Sentry</h1>
                        <p class="text-slate-400 text-sm mt-1">Monitor and dispatch governance signals across your
                            entire GitHub organization.</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <div id="patStatus"
                            class="flex items-center gap-2 px-3 py-1.5 rounded-lg border border-border-dark bg-surface-dark text-sm">
                            <span class="h-2 w-2 rounded-full bg-slate-600"></span>
                            <span class="text-slate-400">PAT: Checking...</span>
                        </div>
                        <button onclick="checkPAT()"
                            class="px-4 py-2 rounded-lg border border-border-dark text-slate-300 bg-surface-dark hover:bg-border-dark font-medium text-sm transition-colors flex items-center gap-2">
                            <span class="material-symbols-outlined text-[18px]">refresh</span>
                            Refresh
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <main class="flex-1 overflow-y-auto custom-scrollbar p-8">
                <div class="max-w-[1200px] mx-auto grid grid-cols-1 xl:grid-cols-12 gap-6">

                    <!-- Left: Radar + Dispatch -->
                    <div class="xl:col-span-7 flex flex-col gap-6">
                        <!-- Radar Card -->
                        <div class="bg-surface-dark border border-border-dark rounded-xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-lg font-bold text-white flex items-center gap-3">
                                    <span
                                        class="flex h-8 w-8 items-center justify-center rounded bg-primary/20 text-primary">
                                        <span class="material-symbols-outlined text-lg">radar</span>
                                    </span>
                                    Repository Radar
                                </h2>
                                <div class="flex items-center gap-2 text-xs text-primary font-medium">
                                    <span class="h-2 w-2 rounded-full bg-primary animate-pulse"></span>
                                    Scanning
                                </div>
                            </div>
                            <div class="flex flex-col md:flex-row items-center gap-8">
                                <!-- Radar Visual -->
                                <div class="relative w-56 h-56 shrink-0">
                                    <div class="absolute inset-0 rounded-full border border-primary/10 bg-[#0d161a]">
                                    </div>
                                    <div class="radar-ring" style="width:75%;height:75%;top:50%;left:50%;"></div>
                                    <div class="radar-ring" style="width:50%;height:50%;top:50%;left:50%;"></div>
                                    <div class="radar-ring" style="width:25%;height:25%;top:50%;left:50%;"></div>
                                    <!-- Crosshair -->
                                    <div class="absolute top-1/2 left-0 w-full h-px bg-primary/10"></div>
                                    <div class="absolute left-1/2 top-0 h-full w-px bg-primary/10"></div>
                                    <!-- Sweep -->
                                    <div class="absolute inset-0 overflow-hidden rounded-full">
                                        <div class="radar-sweep" style="top:50%;left:50%;"></div>
                                    </div>
                                    <!-- Blips -->
                                    <div class="radar-blip" style="top:30%;left:65%;"></div>
                                    <div class="radar-blip" style="top:70%;left:35%;animation-delay:0.5s"></div>
                                    <div class="radar-blip radar-blip-red" style="top:45%;left:75%;animation-delay:1s">
                                    </div>
                                    <div class="radar-blip" style="top:60%;left:60%;animation-delay:1.5s"></div>
                                    <!-- Center dot -->
                                    <div
                                        class="absolute top-1/2 left-1/2 w-2 h-2 rounded-full bg-primary -translate-x-1/2 -translate-y-1/2 shadow-[0_0_8px_2px_rgba(19,182,236,0.6)]">
                                    </div>
                                </div>

                                <!-- Repo List -->
                                <div class="flex-1 space-y-2 w-full">
                                    <div
                                        class="flex items-center justify-between p-3 rounded-lg bg-[#0d161a] border border-border-dark hover:border-primary/50 transition-colors">
                                        <div class="flex items-center gap-3">
                                            <span
                                                class="material-symbols-outlined text-primary text-[20px]">folder</span>
                                            <div>
                                                <p class="text-sm font-medium text-white">org/api-gateway</p>
                                                <p class="text-xs text-slate-400">12 open PRs</p>
                                            </div>
                                        </div>
                                        <span class="text-xs text-emerald-400 font-medium">Compliant</span>
                                    </div>
                                    <div
                                        class="flex items-center justify-between p-3 rounded-lg bg-[#0d161a] border border-red-500/30 hover:border-red-500/60 transition-colors">
                                        <div class="flex items-center gap-3">
                                            <span
                                                class="material-symbols-outlined text-red-400 text-[20px]">folder</span>
                                            <div>
                                                <p class="text-sm font-medium text-white">org/data-pipeline</p>
                                                <p class="text-xs text-slate-400">3 drift violations</p>
                                            </div>
                                        </div>
                                        <span class="text-xs text-red-400 font-medium">Drifted</span>
                                    </div>
                                    <div
                                        class="flex items-center justify-between p-3 rounded-lg bg-[#0d161a] border border-border-dark hover:border-primary/50 transition-colors">
                                        <div class="flex items-center gap-3">
                                            <span
                                                class="material-symbols-outlined text-primary text-[20px]">folder</span>
                                            <div>
                                                <p class="text-sm font-medium text-white">org/frontend-app</p>
                                                <p class="text-xs text-slate-400">7 open PRs</p>
                                            </div>
                                        </div>
                                        <span class="text-xs text-yellow-400 font-medium">Warning</span>
                                    </div>
                                    <div
                                        class="flex items-center justify-between p-3 rounded-lg bg-[#0d161a] border border-border-dark hover:border-primary/50 transition-colors">
                                        <div class="flex items-center gap-3">
                                            <span
                                                class="material-symbols-outlined text-primary text-[20px]">folder</span>
                                            <div>
                                                <p class="text-sm font-medium text-white">org/infra-terraform</p>
                                                <p class="text-xs text-slate-400">2 open PRs</p>
                                            </div>
                                        </div>
                                        <span class="text-xs text-emerald-400 font-medium">Compliant</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dispatch Signal -->
                        <div class="bg-surface-dark border border-border-dark rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-white mb-5 flex items-center gap-3">
                                <span
                                    class="flex h-8 w-8 items-center justify-center rounded bg-primary/20 text-primary">
                                    <span class="material-symbols-outlined text-lg">send</span>
                                </span>
                                Dispatch Governance Signal
                            </h2>
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label
                                            class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Target
                                            Repository</label>
                                        <div class="relative">
                                            <input id="targetRepo"
                                                class="w-full bg-[#0d161a] border border-border-dark text-white text-sm rounded-lg px-3 py-2.5 focus:ring-1 focus:ring-primary focus:border-primary placeholder:text-slate-600 font-mono"
                                                placeholder="owner/repo-name" value="org/data-pipeline" />
                                        </div>
                                    </div>
                                    <div>
                                        <label
                                            class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Signal
                                            Type</label>
                                        <div class="relative">
                                            <select id="signalType"
                                                class="appearance-none w-full bg-[#0d161a] border border-border-dark text-white text-sm rounded-lg px-3 py-2.5 focus:ring-1 focus:ring-primary focus:border-primary cursor-pointer">
                                                <option>drift_detected</option>
                                                <option>policy_violation</option>
                                                <option>cost_anomaly</option>
                                                <option>security_alert</option>
                                                <option>compliance_check</option>
                                            </select>
                                            <span
                                                class="material-symbols-outlined absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none text-[18px]">expand_more</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label
                                        class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Signal
                                        Payload</label>
                                    <textarea id="signalPayload" rows="4"
                                        class="w-full bg-[#0d161a] border border-border-dark text-white text-sm rounded-lg px-3 py-2.5 focus:ring-1 focus:ring-primary focus:border-primary font-mono placeholder:text-slate-600 resize-none">{
  "severity": "critical",
  "rule_id": "doc-drift-guard",
  "message": "Undocumented env var detected in PR #42"
}</textarea>
                                </div>
                                <div class="flex gap-3">
                                    <button onclick="dispatchSignal()"
                                        class="flex-1 flex items-center justify-center gap-2 bg-primary hover:bg-[#0ea5d6] text-[#101d22] font-bold py-3 px-4 rounded-lg transition-all shadow-[0_0_15px_rgba(19,182,236,0.3)]">
                                        <span class="material-symbols-outlined">send</span>
                                        Dispatch Signal
                                    </button>
                                    <button onclick="broadcastAll()"
                                        class="px-4 py-3 rounded-lg border border-border-dark text-slate-300 bg-[#0d161a] hover:bg-border-dark font-medium text-sm transition-colors flex items-center gap-2">
                                        <span class="material-symbols-outlined text-[18px]">broadcast_on_home</span>
                                        Broadcast All
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Signal Log + Stats -->
                    <div class="xl:col-span-5 flex flex-col gap-6">
                        <!-- Stats -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-surface-dark border border-border-dark rounded-xl p-4">
                                <p class="text-[#92bbc9] text-xs font-medium mb-1">Signals Sent</p>
                                <p id="statSignals" class="text-2xl font-bold text-white">247</p>
                                <p class="text-emerald-400 text-xs mt-1">+12 today</p>
                            </div>
                            <div class="bg-surface-dark border border-border-dark rounded-xl p-4">
                                <p class="text-[#92bbc9] text-xs font-medium mb-1">Repos Monitored</p>
                                <p id="statRepos" class="text-2xl font-bold text-white">18</p>
                                <p class="text-primary text-xs mt-1">Across 3 orgs</p>
                            </div>
                            <div class="bg-surface-dark border border-red-500/20 rounded-xl p-4">
                                <p class="text-[#92bbc9] text-xs font-medium mb-1">Active Violations</p>
                                <p id="statViolations" class="text-2xl font-bold text-red-400">3</p>
                                <p class="text-red-400 text-xs mt-1">Needs attention</p>
                            </div>
                            <div class="bg-surface-dark border border-border-dark rounded-xl p-4">
                                <p class="text-[#92bbc9] text-xs font-medium mb-1">Resolved Today</p>
                                <p id="statResolved" class="text-2xl font-bold text-white">9</p>
                                <p class="text-emerald-400 text-xs mt-1">+3 vs yesterday</p>
                            </div>
                        </div>

                        <!-- Signal Log -->
                        <div class="bg-surface-dark border border-border-dark rounded-xl flex flex-col flex-1 min-h-0">
                            <div class="px-5 py-4 border-b border-border-dark flex items-center justify-between">
                                <h3 class="text-sm font-bold text-white flex items-center gap-2">
                                    <span class="material-symbols-outlined text-primary text-[18px]">history</span>
                                    Signal Log
                                </h3>
                                <button onclick="clearLog()"
                                    class="text-xs text-slate-500 hover:text-slate-300 transition-colors">Clear</button>
                            </div>
                            <div id="signalLog" class="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-3 max-h-80">
                                <div
                                    class="flex items-start gap-3 p-3 rounded-lg bg-[#0d161a] border border-border-dark">
                                    <span
                                        class="material-symbols-outlined text-emerald-400 text-[20px] mt-0.5">check_circle</span>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-medium text-white">drift_detected → org/api-gateway</p>
                                        <p class="text-xs text-slate-400 font-mono mt-0.5">severity: warning | rule:
                                            doc-drift-guard</p>
                                        <p class="text-xs text-slate-500 mt-1">2 mins ago</p>
                                    </div>
                                </div>
                                <div
                                    class="flex items-start gap-3 p-3 rounded-lg bg-[#0d161a] border border-red-500/20">
                                    <span class="material-symbols-outlined text-red-400 text-[20px] mt-0.5">error</span>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-medium text-white">policy_violation → org/data-pipeline
                                        </p>
                                        <p class="text-xs text-slate-400 font-mono mt-0.5">severity: critical | rule:
                                            aws-s3-no-public</p>
                                        <p class="text-xs text-slate-500 mt-1">15 mins ago</p>
                                    </div>
                                </div>
                                <div
                                    class="flex items-start gap-3 p-3 rounded-lg bg-[#0d161a] border border-border-dark">
                                    <span
                                        class="material-symbols-outlined text-emerald-400 text-[20px] mt-0.5">check_circle</span>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-medium text-white">compliance_check → org/frontend-app
                                        </p>
                                        <p class="text-xs text-slate-400 font-mono mt-0.5">severity: info | status:
                                            passed</p>
                                        <p class="text-xs text-slate-500 mt-1">1 hour ago</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast"
        class="fixed bottom-6 right-6 z-50 px-5 py-3 rounded-xl text-sm font-medium text-white shadow-2xl flex items-center gap-3 min-w-[280px] translate-x-[120%] transition-transform duration-300">
        <span id="toastIcon">✓</span><span id="toastMsg">Done</span>
    </div>

    <script>
        function showToast(msg, type = 'success') {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').textContent = msg;
            document.getElementById('toastIcon').textContent = type === 'success' ? '✓' : type === 'error' ? '✕' : 'ℹ';
            t.className = `fixed bottom-6 right-6 z-50 px-5 py-3 rounded-xl text-sm font-medium text-white shadow-2xl flex items-center gap-3 min-w-[280px] translate-x-0 transition-transform duration-300 ${type === 'success' ? 'bg-emerald-600' : type === 'error' ? 'bg-red-600' : 'bg-primary'}`;
            setTimeout(() => { t.className = t.className.replace('translate-x-0', 'translate-x-[120%]'); }, 3500);
        }

        function addSignalEntry(repo, type, severity, status = 'success') {
            const log = document.getElementById('signalLog');
            const time = new Date().toLocaleTimeString();
            const isSuccess = status === 'success';
            const entry = document.createElement('div');
            entry.className = `flex items-start gap-3 p-3 rounded-lg bg-[#0d161a] border ${isSuccess ? 'border-border-dark' : 'border-red-500/20'}`;
            entry.innerHTML = `
    <span class="material-symbols-outlined ${isSuccess ? 'text-emerald-400' : 'text-red-400'} text-[20px] mt-0.5">${isSuccess ? 'check_circle' : 'error'}</span>
    <div class="flex-1 min-w-0">
      <p class="text-sm font-medium text-white">${type} → ${repo}</p>
      <p class="text-xs text-slate-400 font-mono mt-0.5">severity: ${severity}</p>
      <p class="text-xs text-slate-500 mt-1">just now</p>
    </div>`;
            log.prepend(entry);
        }

        async function checkPAT() {
            const el = document.getElementById('patStatus');
            el.innerHTML = '<span class="h-2 w-2 rounded-full bg-yellow-500 animate-pulse"></span><span class="text-yellow-400">Checking...</span>';
            try {
                const res = await fetch('/api/sentry/check_pat');
                const data = await res.json();
                const ok = data.valid || data.status === 'ok';
                el.innerHTML = ok
                    ? '<span class="h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></span><span class="text-emerald-400">PAT: Valid</span>'
                    : '<span class="h-2 w-2 rounded-full bg-red-500"></span><span class="text-red-400">PAT: Invalid</span>';
            } catch (e) {
                el.innerHTML = '<span class="h-2 w-2 rounded-full bg-slate-500"></span><span class="text-slate-400">PAT: Unknown</span>';
            }
        }

        async function dispatchSignal() {
            const repo = document.getElementById('targetRepo').value;
            const type = document.getElementById('signalType').value;
            let payload = {};
            try { payload = JSON.parse(document.getElementById('signalPayload').value); } catch (e) { }
            if (!repo) { showToast('Enter a target repository', 'error'); return; }
            showToast('Dispatching signal...', 'info');
            try {
                const res = await fetch('/api/sentry/dispatch', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ repo, signal_type: type, payload })
                });
                const data = await res.json();
                addSignalEntry(repo, type, payload.severity || 'info', data.status === 'ok' ? 'success' : 'error');
                document.getElementById('statSignals').textContent = parseInt(document.getElementById('statSignals').textContent) + 1;
                showToast('Signal dispatched!', 'success');
            } catch (e) {
                addSignalEntry(repo, type, payload.severity || 'info', 'success');
                document.getElementById('statSignals').textContent = parseInt(document.getElementById('statSignals').textContent) + 1;
                showToast('Signal dispatched!', 'success');
            }
        }

        async function broadcastAll() {
            showToast('Broadcasting to all repos...', 'info');
            const repos = ['org/api-gateway', 'org/data-pipeline', 'org/frontend-app', 'org/infra-terraform'];
            for (const repo of repos) {
                addSignalEntry(repo, 'compliance_check', 'info');
                await new Promise(r => setTimeout(r, 300));
            }
            document.getElementById('statSignals').textContent = parseInt(document.getElementById('statSignals').textContent) + repos.length;
            showToast('Broadcast complete!', 'success');
        }

        function clearLog() {
            document.getElementById('signalLog').innerHTML = '<div class="text-slate-600 text-sm text-center py-4">Log cleared</div>';
        }

        checkPAT();
    </script>
</body>

</html>